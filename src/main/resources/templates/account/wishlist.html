<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ulubione - PetMarket</title>
    <link rel="stylesheet" href="/css/account-styles.css">
</head>
<body>
<div th:replace="~{fragments/header :: navbar}"></div>
<div class="account-container">
    <aside th:replace="~{fragments/account-sidebar :: sidebar('wishlist')}"></aside>
    <main class="account-content">
        <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div>
                <h1 class="content-title">Ulubione</h1>
                <p class="content-subtitle" th:text="${products.size()} + ' produkt√≥w'"></p>
            </div>
            <form th:if="${!products.isEmpty()}" th:action="@{/wishlist/clear}" method="post" onsubmit="return confirm('Wyczy≈õciƒá wszystko?')">
                <button type="submit" class="btn-outline" style="color: #ef4444; border-color: #ef4444;">Wyczy≈õƒá wszystko</button>
            </form>
        </div>

        <div class="wishlist-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px;">
            <div th:each="product : ${products}" class="product-card" style="background: white; border: 1px solid #eee; border-radius: 12px; position: relative; padding: 15px;">
                <button class="remove-btn" th:attr="data-product-id=${product.id}" onclick="handleRemove(this)" style="position: absolute; top: 10px; left: 10px; border: none; background: white; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">‚ù§Ô∏è</button>

                <a th:href="@{/product/{id}(id=${product.id})}" style="text-decoration: none; color: inherit;">
                    <div class="product-image" style="height: 180px; display: flex; align-items: center; justify-content: center; font-size: 60px;" th:text="${product.imageUrl ?: 'ü¶¥'}"></div>
                    <h3 th:text="${product.name}" style="font-size: 16px; margin: 10px 0;"></h3>
                    <div class="price" style="font-weight: bold; color: var(--brand-green); font-size: 18px;" th:text="${#numbers.formatDecimal(product.price, 1, 2)} + ' z≈Ç'"></div>
                </a>

                <button class="btn-primary" style="width: 100%; margin-top: 15px;" th:onclick="'handleAddToCart(this, event, ' + ${product.id} + ')'">Do koszyka</button>
            </div>
        </div>

        <div th:if="${products.isEmpty()}" class="empty-state" style="text-align: center; padding: 50px;">
            <div style="font-size: 60px;">‚ù§Ô∏è</div>
            <h2>Brak ulubionych</h2>
            <a th:href="@{/}" class="btn-primary" style="display: inline-block; margin-top: 20px;">PrzeglƒÖdaj sklep</a>
        </div>
    </main>
</div>

<script>
    function handleRemove(btn) {
        const id = btn.getAttribute('data-product-id');
        if(!confirm('UsunƒÖƒá?')) return;
        fetch('/wishlist/toggle', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({productId: id})
        }).then(r => r.json()).then(data => {
            if(data.success) location.reload();
        });
    }
</script>
</body>
</html>