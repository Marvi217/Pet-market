<!DOCTYPE html>
<html lang="pl" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Zamówienie #' + ${order.orderNumber} + ' - Panel Admina'"></title>
    <link rel="stylesheet" th:href="@{/css/admin-styles.css}">
</head>
<body>
<div class="admin-wrapper">
    <aside th:replace="~{fragments/admin-fragments :: sidebar('orders')}"></aside>

    <main class="admin-main">
        <div class="admin-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Zamówienie <span th:text="'#' + ${order.orderNumber}"></span></h1>
                    <p class="page-subtitle" th:text="'Złożone: ' + ${#temporals.format(order.orderDate, 'dd.MM.yyyy HH:mm')}"></p>
                </div>
                <div class="page-actions">
                    <a th:href="@{/admin/orders}" class="btn btn-secondary">Powrót do listy</a>
                    <a th:href="@{/admin/orders/{id}/edit(id=${order.id})}" class="btn btn-primary">Edytuj statusy</a>
                </div>
            </div>

            <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>

            <div class="admin-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px;">
                <div class="grid-column-main">
                    <div class="card">
                        <div class="card-header"><h2 class="card-title">Produkty</h2></div>
                        <div class="card-body">
                            <table class="admin-table">
                                <thead>
                                <tr>
                                    <th>Produkt</th>
                                    <th>Cena jedn.</th>
                                    <th>Ilość</th>
                                    <th>Suma</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="item : ${order.items}">
                                    <td th:text="${item.product.name}"></td>
                                    <td th:text="${#numbers.formatDecimal(item.price, 1, 2)} + ' zł'"></td>
                                    <td th:text="${item.quantity}"></td>
                                    <td th:text="${#numbers.formatDecimal(item.price * item.quantity, 1, 2)} + ' zł'"></td>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="3" style="text-align: right;"><strong>Razem:</strong></td>
                                    <td><strong th:text="${#numbers.formatDecimal(order.totalAmount, 1, 2)} + ' zł'"></strong></td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 25px;" th:if="${order.adminNotes}">
                        <div class="card-header"><h2 class="card-title">Uwagi administratora</h2></div>
                        <div class="card-body">
                            <p th:text="${order.adminNotes}"></p>
                        </div>
                    </div>
                </div>

                <div class="grid-column-sidebar">
                    <div class="card">
                        <div class="card-header"><h2 class="card-title">Statusy</h2></div>
                        <div class="card-body">
                            <div class="status-info">
                                <p>Zamówienie: <span th:class="'badge status-' + ${#strings.toLowerCase(order.status)}" th:text="${order.status.displayName}"></span></p>
                                <p>Płatność: <span th:class="'badge payment-' + ${#strings.toLowerCase(order.paymentStatus)}" th:text="${order.paymentStatus.displayName}"></span></p>
                            </div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header"><h2 class="card-title">Klient i dostawa</h2></div>
                        <div class="card-body">
                            <p><strong th:text="${order.user.getFullName()}"></strong></p>
                            <p style="color: var(--text-muted);" th:text="${order.user.email}"></p>
                            <hr style="margin: 15px 0; border: 0; border-top: 1px solid #eee;">
                            <h4 style="font-size: 12px; color: gray; text-transform: uppercase;">Adres:</h4>
                            <p th:if="${order.shippingAddress}">
                                <span th:text="${order.shippingAddress.street}"></span><br>
                                <span th:text="${order.shippingAddress.zipCode + ' ' + order.shippingAddress.city}"></span>
                            </p>
                        </div>
                    </div>

                    <div style="margin-top: 20px;" th:if="${order.status != T(com.example.petmarket.enums.OrderStatus).CANCELLED}">
                        <form th:action="@{/admin/orders/{id}/cancel(id=${order.id})}" method="post" onsubmit="return confirm('Anulować zamówienie?')">
                            <button type="submit" class="btn btn-error" style="width: 100%;">Anuluj zamówienie</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>
</body>
</html>